# hia-realm 项目 Debug 报告

**生成时间**: 2026-02-03 16:59 (UTC+8)
**审核范围**: 全仓库静态审查（未编译/未运行）

---

## 📁 项目文件概览

| 文件 | 行数 | 最近修改 |
|------|------|----------|
| [`install.sh`](../install.sh) | 914 | 2026-02-03 16:57 |
| [`panel.sh`](../panel.sh) | 1710 | 2026-02-03 16:57 |
| [`port-traffic-dog.sh`](../port-traffic-dog.sh) | 2883 | 2026-02-03 16:57 |
| [`quickpanel.sh`](../quickpanel.sh) | 117 | 2026-02-03 16:57 |
| [`test.sh`](../test.sh) | 1012 | 2026-02-03 16:57 |
| [`unipan.sh`](../unipan.sh) | 56 | 2026-02-03 16:57 |
| [`README.md`](../README.md) | 519 | 2026-02-03 16:57 |

---

## 🔍 主要问题（按严重度）

### 🔴 高风险 / 安全
1. **远程节点 API 默认使用 HTTP 传输令牌**
   - **位置**: `panel.sh`（`call_remote_api`）
   - **问题**: 默认拼接 `http://`，API 令牌可能被嗅探/中间人截获。
   - **建议**: 强制 HTTPS 或提供“允许 HTTP”的显式开关，并在 UI 提示风险。

2. **多处 `curl | bash` 且以 root 执行**
   - **位置**: `install.sh` / `panel.sh`
   - **问题**: 供应链风险（下载脚本无校验/版本锁定）。
   - **建议**: 固定版本号 + 校验哈希/签名；尽量下载后校验再执行。

### 🟠 中等风险 / 兼容性
3. **`/api/rules` 响应结构已变更**
   - **位置**: `panel.sh`（`get_rules`）
   - **问题**: 由“完整 AppData”变为仅 `{rules}`，旧客户端/脚本可能失效。
   - **建议**: 提供兼容字段或版本化接口。

4. **远程规则加载失败时 UI 无明显错误**
   - **位置**: `panel.sh`（前端 `openNodeRules`）
   - **问题**: 后端返回 `{status:"error"}` 但 HTTP 仍为 200，前端当作空列表处理。
   - **建议**: 后端失败时返回非 2xx，或前端检测 `status==='error'` 并提示。

5. **节点地址格式缺少校验**
   - **位置**: `panel.sh`（`call_remote_api` 组装 URL）
   - **问题**: 若用户填入带端口或带协议地址，可能拼出非法 URL（如 `host:port:port`）。
   - **建议**: 明确输入规则或自动解析并规范化。

### 🟡 低风险 / 体验
6. **`/api/nodes` 返回完整 `api_token`**
   - **位置**: `panel.sh`（`get_nodes`）
   - **问题**: UI 中直接暴露所有远程节点 token。
   - **建议**: 默认隐藏/脱敏，提供“点击复制”。

---

## ✅ 通过项 / 未发现

- 未发现 `TODO / FIXME / XXX` 明示的遗留风险。
- 结构上未发现明显语法错误（**未编译验证**）。

---

## 🧪 建议测试清单（未执行）

- `bash -n install.sh`
- `bash -n panel.sh`
- `bash -n port-traffic-dog.sh`
- 远程节点联通性测试：
  - D 端添加 B 节点 → 获取 B 规则 → 新增规则 → B 实际生效。

---

## 📌 结论

整体功能已具备，远程节点管理可以工作，但安全与兼容性方面仍有 2～3 处需要补强。若面板开放公网，建议优先处理“HTTPS + 令牌保护”。

*报告由 Codex 生成（静态审查）*
